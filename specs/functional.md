# 機能仕様書 (メモ システムが何をするか)

## 概要

日本で使用してもらうことを目標にする。
そのために日本で普及している一般的なレンタルサーバーで稼働する必要がある。

## 各ページで何をするか

* サイトトップ
    * 最新の投稿をグリッド表示(PC)
    * 最新の投稿を表示(SP)
    * パーソナライズされたフィード表示
    * トレンド・人気投稿のハイライト
    * クイック検索機能
    * カテゴリー/トピックナビゲーション
    * 未読通知インジケーター
* 検索結果
    * 論理構造のツリー表示機能
    * 高度なフィルタリングオプション（日付、投稿種類、ユーザー）
    * ネットワークビュー/ツリービュー/時系列ビュー切替
    * ズームレベルコントロール
    * 検索結果のエクスポート機能
    * 関連キーワード提案
* 投稿ページ
    * 投稿形式選択（9種類）
    * 「主張」「根拠」「論拠」入力フォーム
    * マルチメディア添付（PDF、画像、音声、URL）
    * 数式エディタ
    * 下書き保存機能
    * タグ・カテゴリ付け
    * センシティブコンテンツフラグ設定
    * 関連コミュニティ通知設定
    * AI文章校正・改善提案
* 投稿詳細ページ
    * 関連投稿ツリー表示
    * リアクション機能
    * 検証ステータス表示
    * 関連投稿推奨
    * 共有機能
    * 証拠ファイルプレビュー
* 理念ページ
    * プラットフォームの目的説明
    * 利用ガイドライン
    * 検証プロセスの説明
* お問い合わせページ
    * 問い合わせフォーム
    * FAQ参照リンク
* よくある質問ページ
    * カテゴリ別FAQ
    * 検索機能
    * チュートリアルリンク
* ログインページ
    * ログインフォーム
    * パスワードリセット
    * 新規登録リンク
    * OAuth連携（保留）
* アカウント管理ページ
    * プロフィール編集
    * 通知設定
    * プライバシー設定
    * コンテンツフィルター設定
    * アカウントセキュリティ設定
    * 言語・アクセシビリティ設定
* サインアップページ
    * 登録フォーム
    * 利用規約同意
    * 関心コミュニティ選択
    * チュートリアル開始オプション
* ユーザープロフィールページ
    * 投稿履歴
    * 貢献度指標表示
    * バッジ・実績表示
    * フォロー管理

## 機能要件リスト

### 主機能

主要機能のまとめ
各機能の目的と基本説明

* 投稿システム
    * 「主張」「根拠」「論拠」のセット形式での投稿機能
    * 9種類の投稿形式（問題提示、問題分割、解決策提示、補足、要約、翻訳、推定、検証、倫理）
    * マルチメディア証拠（PDF、画像、音声、サイトURL、数式）のアップロード
    * センシティブフラグ設定
* 論理構造の可視化
    * ツリー状の議論構造表示
    * 多対多の関係性マッピング
    * 論理的繋がりの視覚化
* ユーザー認証・管理
    * アカウント作成と認証
    * 権限管理
    * ユーザープロファイル
* コンテンツモデレーション
    * 禁止事項（誹謗中傷等）の監視
    * センシティブコンテンツのフィルタリング
    * 証拠の集団検証システム
* 検索・ナビゲーション
    * 問題/解決策の検索
    * フィルタリング機能
    * トピック/カテゴリ分類
* インタラクション機能
    * 投稿への反応（評価等）
    * フォロー機能
    * シェア機能
    * 通知システム

## 詳細機能仕様

### 投稿システム

1. 投稿作成フロー
   * 投稿形式の選択（9種類）
   * 「主張」「根拠」「論拠」の入力フォーム提供
   * マルチメディア添付機能
   * 下書き保存と公開設定
   * タグ・カテゴリ付け
   * センシティブコンテンツのフラグ設定

2. 投稿形式詳細
   * 問題提示：社会課題や議論すべきテーマを提起
   * 問題分割：大きな問題を小さな要素に分解して構造化
   * 解決策提示：問題に対する具体的な解決案の提案
   * 補足：既存の投稿に対する追加情報や説明
   * 要約：複雑な議論や多数の投稿内容をまとめる
   * 翻訳：異なる言語での情報提供や言い換え
   * 推定：データや状況から導き出される可能性の提示
   * 検証：証拠に基づく情報の真偽確認や事実検証
   * 倫理：提案や議論の倫理的側面の検討

3. マルチメディア管理
   * 対応フォーマット：PDF(.pdf), 画像(.jpg, .png, .gif), 音声(.mp3, .wav)
   * ファイルサイズ制限：画像10MB、PDF 20MB、音声10MB
   * URLプレビュー生成（OGP取得）
   * 数式エディタ（LaTeX形式サポート）
   * コンテンツの圧縮と最適化処理

4. センシティブコンテンツ管理
   * センシティブフラグの種類：成人向け、暴力的、論争的、不快感を与える可能性
   * ユーザー設定に基づくフィルタリング
   * 年齢確認システムとの連携
   * コンテンツ警告表示

### 論理構造の可視化

1. ツリービュー
   * 親子関係の階層表示（最大10階層まで）
   * ノード折りたたみ/展開機能
   * フォーカスモード（選択ノードを中心とした表示）
   * ズームイン/アウト機能
     * ズームレベルに応じた重要ノード表示（Googleマップライク）
     * 重要度に基づく自動フィルタリング（ズームアウト時は影響度の高いノードのみ表示）
     * ノードの重要度計算指標：投稿の参照数、リアクション数、検証スコア
   * ミニマップナビゲーション
   * 全体把握モード（大規模議論の主要構造のみを表示）

2. ネットワークビュー
   * 多対多の関連性グラフ表示
   * エッジの種類による関係性の区別（反論、支持、参照など）
   * クラスタリングによる関連グループの可視化
   * フィルタリング（日付、投稿種類、ユーザー）
   * 動的密度調整
     * ズームレベルに応じた表示密度の自動調整
     * 低ズームレベルでの主要ノードのみの表示（高影響度ノードの優先表示）
     * 高ズームレベルでの詳細ノード表示
     * ノードサイズの重要度による可変表示

3. 時系列ビュー
   * 議論の発展過程の時間軸表示
   * 重要なターニングポイントのハイライト
   * 活動の集中度合いのヒートマップ
   * 時間軸ズーム機能
     * 時間スケールの拡大・縮小による表示密度の調整
     * マクロビュー（長期間の主要イベントのみ）とミクロビュー（短期間の詳細）の切り替え
     * 重要度に基づくイベントのフィルタリング（低ズームレベルでは主要イベントのみ表示）

### ユーザー体験向上機能

1. オンボーディング
   * 初回ユーザー向けチュートリアル
   * 投稿作成ガイドとテンプレート
   * 初心者モードと詳細モードの切り替え
   * 関心コミュニティ登録プロセス（ユーザー登録時に関心のあるコミュニティを選択）

2. アクセシビリティ
   * スクリーンリーダー対応
   * キーボードナビゲーション
   * 高コントラストモード
   * 文字サイズ調整
   * 音声入力サポート

3. パーソナライゼーション
   * カスタムフィード設定
   * 興味関心に基づく推薦
   * 閲覧履歴ベースの関連コンテンツ表示
   * お気に入りトピック登録

### コミュニティエンゲージメント

1. 信頼性スコアシステム
   * 投稿の証拠品質評価
   * ユーザー貢献度指標
   * ピアレビュー参加度
   * バッジと実績システム

2. 議論促進機能
   * 議論が停滞している投稿のハイライト
   * 関連専門知識を持つユーザーへの参加依頼
   * 建設的な議論を促すプロンプト
   * 定期的なディスカッションイベント開催

3. コラボレーション機能
   * 共同編集モード
   * グループプロジェクト作成
   * 知識共有スペース
   * 専門家パネルディスカッション
   
4. コミュニティ通知機能
   * 投稿時に関連コミュニティへの通知設定
   * 複数コミュニティ選択機能
   * コミュニティメンバーへのカスタム通知
   * 優先コミュニティの設定

### AIアシスタント機能

1. コンテンツ支援
   * 文章校正と改善提案
   * 引用と参考文献の自動フォーマット
   * 関連資料の推奨
   * 要約生成

2. モデレーション支援
   * 不適切コンテンツの自動検出
   * トーン分析と建設的フィードバック
   * 重複内容の検出
   * 誤情報パターンの認識

3. ナビゲーション支援
   * パーソナライズされた探索ルート提案
   * 複雑な議論構造の理解サポート
   * 情報ギャップの特定
   * 学習パスの推奨

## 非機能要件

### パフォーマンス要件
* ページロード時間：2秒以内（95パーセンタイル）
* 大規模ツリー表示時のレンダリング最適化（1000ノード以上）
  * ズームレベルに応じたノード描画の最適化（表示範囲外や重要度の低いノードは省略）
  * ノード重要度計算の効率的なアルゴリズム実装（事前計算とキャッシュの活用）
  * WebGLを活用した大規模グラフの高速レンダリング
* レスポンス時間：API呼び出し200ms以内
* 同時接続ユーザー数：最大10,000ユーザー
* データベースクエリ最適化（複雑な関係性クエリ）
  * ノード重要度指標のインデックス化

### セキュリティ要件
* OWASP Top 10対策の実装
* データ暗号化（保存時と通信時）
* CSRF/XSS対策
* レート制限の実装
* 定期的なセキュリティ監査
* ユーザーデータのアクセス制御

### 拡張性・保守性
* マイクロサービスアーキテクチャの採用 (保留)
* クライアント-サーバーアーキテクチャ
* コンテナ化によるスケーリング対応 (保留)
* CDN活用によるグローバル配信の最適化 (保留)
* バックアップと災害復旧計画 (保留)
* テスト自動化（単体、統合、E2E）
* 継続的インテグレーション/デプロイメント（CI/CD）(保留)

注: デプロイメントとインフラ構成の詳細はクライアント側で対応

### アクセシビリティ
* WCAG 2.1 AA準拠
* 多言語対応（日英）
* モバイルファーストデザイン
* 低速ネットワーク環境への最適化

## 外部システム連携

### API仕様
* REST API：基本的なCRUD操作
* GraphQL：複雑な関係性データの取得

### データ連携フロー
* 学術データベースとの連携(保留)
* ファクトチェックサービスとの統合(保留)
* ソーシャルメディア共有
* 分析ツールへのデータエクスポート(保留)
* インポートAPI
* エクスポートAPI(保留)

### サードパーティ統合
* 学術検索エンジン連携
* オンライン引用生成ツール
* 翻訳サービスAPI
* オープンデータリポジトリ接続
* クラウドストレージ連携

## データモデル

### 主要なデータ構造
* ユーザーモデル（認証情報、プロフィール、設定）
* 投稿モデル（9種類の投稿タイプごとの構造）
* 関連性モデル（投稿間の多対多関係）
* マルチメディアモデル（種類別の添付ファイル）
* インタラクションモデル（リアクション、検証、コメント）
* コミュニティモデル（関心コミュニティ、通知設定）
* 通知モデル（コミュニティ通知を含む）
* タグ・カテゴリモデル

### データフロー図
* ユーザー認証フロー
* 投稿作成と公開プロセス
* 検証ワークフロー
* 検索と発見プロセス
* 通知配信メカニズム
* コンテンツモデレーションフロー

